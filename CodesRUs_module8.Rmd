---
title: "Project 8"
author: "CodesRUS"
date: "11/25/2021"
output: html_document
bibliography: BIOL3140.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction
The forces produced by the tissues in our body are controlled by two main factors: speed and length. While both are equally important, in this project we aim to explore exactly what effect length can have on the force generated by a certain muscle and how fatiguing the muscle can play a role in this. A recent study by (@brughelli2010effects) was able to determine that with eccentric muscle exercise (fatiguing), there was greater extension in our muscles. This study can be analyzed further when we consider that the maximal isometric force of a sarcomere in our muscle is directly related to the degree of actin-myosin overlap. This is not only important from a physiological standpoint as we hope to better understand our muscles, it can provide important information about the longevity and success of athletes. 
	While the mechanical advantage equation is useful in estimating the output of force in your palm, there are other factors to consider. The force produced by the input is variable depending on the insertion angle. In our experiment, we are using the human upper limb, a 3rd order lever, as the subject. Data of the force outputted by the human in both control and fatigued phases was collected at 12 different angles allowing us to analyze the force-length relationship.

## Methods
We analyzed force-length relationship byâ€¦.
1. Producing isometric force-angle curves for the human forearm and flexors undertaking maximum voluntary contractions 
2. Comparing the angle at which maximum isometric force occurs between non-fatigued and eccentrically fatigued forearm flexors
3. Discussing the underlying mechanisms resulting in a shift of theta max after eccentric fatigue 

We first created a ganiometer so that we could measure the angle between our upper and lower arms when collecting our data. After collecting the data we aimed to analyze the force-length relationship in two main ways. Firstly, we produced isometric force-angle curves for the human forearm and flexors undertaking maximum voluntary contractions. Secondly, we compared the angle at which the maximum isometric force occurred between the non-fatigued and the eccentrically fatigued forearm flexors. To do this we started by determining the maximum force for each recording and normalizing them against the controlled and fatigued data. 

## Results

```{r, include=FALSE}
library(tidyverse)
library(MuMIn)
library(ggplot2)
```


```{r, "loading data and creating proper data set", echo=TRUE, results=FALSE, message=FALSE}
ang <- seq(45,157.5,length.out = 11)

k <- list.files("./Project8Data", full.names = T)

k.l <- list()
for(i in k){
  met.dat <- unlist(strsplit(i,"_"))
  sub <- met.dat[2]
  ang <- as.numeric(met.dat[3])
  exp <- gsub("\\..+","",met.dat[4])
  k.l[[i]] <- read_delim(i,delim = " ", col_names = c("Reading","Force","Unit"), id="Experiment") %>%
    mutate(sub=sub,ang=ang,exp=exp)
}
```

[cpk] Here's your issue, the columns don't match. Have a look at the code in the discussion related to this. 
```{r, "data organization and clean up", echo=TRUE, results=FALSE, message=FALSE}
data <- do.call(rbind, k.l)

data <- data%>%
  group_by(sub,exp,ang)%>%
  summarise(max.force=max(abs(Force), na.rm=TRUE), n=n())

data <- na.omit(data)
#print(data)

data.max <- data%>%
  group_by(exp)%>%
  summarize(max.f2 = max(max.force))
#print(data.max)

data.joined <- data%>%
  left_join(data.max)%>%
  mutate(norm.force=max.force/max.f2)
```

```{r, "finding the angle with maximum force"}
ang <- seq(45, 157.5, length.out=11)

data.joined %>%
  ggplot(aes(ang, norm.force))+geom_point()+geom_point(aes(x=angle[which.max(norm.force)], y=norm.force[which.max(norm.force)]), col="red", size=4)+facet_wrap(~exp, ncol=5)

data.joined$ang[which.max(data.joined$norm.force)]
```
```{r}
normf.fat <- filter(data.joined, exp=="fatigue")
normf.con <- filter(data.joined, exp=="control")

poly.m2.fat <- lm(norm.force~poly(ang,2), normf.fat)
poly.m3.fat <- lm(norm.force~poly(ang,3), normf.fat)
poly.m4.fat <- lm(norm.force~poly(ang,4), normf.fat)

AICc(poly.m2.fat, poly.m3.fat, poly.m4.fat)
#second order
poly.m2.con <- lm(norm.force~poly(ang,2), normf.con)
poly.m3.con <- lm(norm.force~poly(ang,3), normf.con)
poly.m4.con <- lm(norm.force~poly(ang,4), normf.con)

AICc(poly.m2.con, poly.m3.con, poly.m4.con)
##second order
```

```{r}
x.pred <- seq(45, 157.5, length.out=1000)

normf.pred.con <- predict(poly.m2.con, newdata=data.frame(ang=x.pred))

normf.con%>%
  ggplot(aes(ang, norm.force))+geom_point()+geom_point(aes(x=x.pred, y=normf.pred.fat), col="red") + geom_point(aes(x=x.pred[which.max(normf.pred.fat)], y=normf.pred.fat[which.max(normf.pred.fat)]), size=5, col="blue")

normf.pred.fat <- predict(poly.m2.fat, newdata=data.frame(ang=x.pred))

normf.pred.fat %>%
  ggplot(aes(ang, norm.force))+geom_point()+geom_point(aes(x=x.pred, y=normf.pred.fat), col="red") + geom_point(aes(x=x.pred[which.max(normf.pred.fat)], y=normf.pred.fat[which.max(normf.pred.fat)]), size=5, col="blue")

x.pred[which.max(normf.pred.fat)]~x.pred[which.max(normf.pred.con)]
```

```{r}
anova(lm())
```


## Discussion

## Contributions

## References

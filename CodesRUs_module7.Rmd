---
title: "Project 7"
author: "CodesRUs"
date: "11/3/2021"
output: html_document
bibliography: BIOL3140.bib
---

### Introduction
When conducting comparative analyses on traits measured from related species, phylogenetic structures are not always taken in consideration, one reason being that phylogenetic comparative models might overlook the importance of abrupt shifts in traits produced by singular events (@garamszegi2014modern). In order to find out whether phylogenetic signals are indeed present in the Tb/body mass relationship of different species or not, we reexamined the data from Mortola and Lanthier (2004) using Pagel’s lamba, and compared the scaling of Tb variables between the ones we applied with the best fitted PGLS and the original results from Mortola and Lanthier (2004).

### Methods
In this study, we try to produce a phylogenetically corrected model measuring the relationship between body mass and temperature in different species. We first produce a linear model of T.high, T.low, and T.diff to find the best fit. Then, we use Pagel’s Lambda to find significant phylogenetic signals and p-value. After we find the significance of four variables, we apply PLGS analysis and log-transformed with Brownian model/Ornstein-Uhlenbeck (OU) models to evaluate character evolution over a phylogenetic tree. We find the best fit model from BM and OU model by calculating the AIC score. At the end of the project, we perform ANOVA test to compare the significance between our best fit model and Montrola’s model.

###Results
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(geiger)
library(dplyr)
library(ggplot2)
library(MuMIn)
library(nlme)
library(ape)
library(phytools)
```

```{r, include=FALSE}
m.phy <- read.tree("mammal.tree.pruned.txt")
m.phy$tip.label <- gsub("(\\w+)_(\\w+)","\\1\\2",m.phy$tip.label)

m.phy0<- rescale(m.phy, model = "lambda", 0)
m.phy5 <- rescale(m.phy, model = "lambda", 0.5)

par(mfcol = c(1, 3))

sim.trait <- runif(Ntip(m.phy))
names(sim.trait) <- m.phy$tip.label
sim.sig <- phylosig(m.phy,sim.trait,method="lambda",test=T)

mammal.temp <- read.csv("mammal.temp2.csv")
mammal.temp <- mammal.temp%>%
  mutate(T.delta = abs(T.high-T.low))
mammal.temp.log <- mammal.temp %>%
  mutate_at(c("mass.g", "T.high", "T.low", "T.delta"), log)
```

```{r, "Phylogenetic Relationship of Data set", fig.cap="Figure Set 1: Phylogenetic Relationship of Data Set Visualized in Multiple Ways", warning=FALSE, echo=FALSE}
plot(m.phy)
plot(m.phy5)
plot(m.phy0)
```

The above are representations of the phylogentic relationships of the data set used by Mortola and Lanthier (2004).

```{r, "Log-Log Regression Model with T.delta", fig.cap="Figure 2: Log-Log Regression Model Using Temperature Difference", warning=FALSE, echo=FALSE}
mammal.temp.log%>%
  ggplot(aes(mass.g,T.delta))+geom_point()+geom_smooth(method = "lm", se = F)
```

```{r, "Log-Log Regression Model with T.high", fig.cap="Figure 3: Log-Log Regression Model Using Temperature Max", warning=FALSE, echo=FALSE}
mammal.temp.log%>%
  ggplot(aes(mass.g,T.high))+geom_point()+geom_smooth(method = "lm", se = F)
```

```{r, "Log-Log Regression Model with T.low", fig.cap="Figure 4: Log-Log Regression Model Using Temperature Min", warning=FALSE, echo=FALSE}
mammal.temp.log%>%
  ggplot(aes(mass.g,T.low))+geom_point()+geom_smooth(method = "lm", se= F)
```

The above models are reproductions of the scaling relationships (log-log regression models) Mortola and Lanthier (2004) for temperature min (Tmin), temperature max (Tmax), and temperature difference (Tdelta).

```{r, "Forming the Linear Models", include=FALSE}
mammal.diff.lm <- lm(T.delta ~ mass.g, mammal.temp.log)
mammal.high.lm <- lm(T.high ~ mass.g, mammal.temp.log)
mammal.low.lm <- lm(T.low ~ mass.g, mammal.temp.log)
```

```{r, "AICw Linear Models", fig.cap="AICw Linear Models", warning=FALSE, echo=FALSE}
mammal.temp.aic <- AICc(mammal.diff.lm, mammal.high.lm, mammal.low.lm)
mammal.temp.aicw <- aicw(mammal.temp.aic$AICc)
print(mammal.temp.aicw)
```
Given the AIC and AICw tests complete, the linear model of mammal.high.lm is seemingly the best fit given the lowest value in chart depicted above. 

```{r, "Summary of Linear Models", include=FALSE}
summary(mammal.diff.lm)
summary(mammal.high.lm)
summary(mammal.low.lm)
```

```{r, "Table for Slope And Intercept Values of Linear Models", fig.cap="Table 1: Slope And Intercept Values of Linear Models", warning=FALSE, echo=FALSE}
mammal.lm.table <- matrix(c(1.07127, -0.11518, 3.6480114, -0.0010265, 3.577075, 0.003091), ncol=2, byrow = TRUE)
rownames(mammal.lm.table) <- c("Delta", "High", "Low")
colnames(mammal.lm.table) <- c("Intercept", "Slope")
mammal.lm.table <- as.table(mammal.lm.table)
print(mammal.lm.table)
```

The above table shows the slope and intercept values of the linear models given the different temperature variables applied.

```{r, "Evaluting Lambda Values and P-Values to Find the Significant Phylogentic Signal in the Four Variables", include=FALSE}
mass.trait <- mammal.temp$mass.g
names(mass.trait) <- mammal.temp.log$species
mass.trait <- phylosig(m.phy,mass.trait,method="lambda",test=T)

T.delta.trait <- mammal.temp$T.delta
names(T.delta.trait) <- mammal.temp.log$species
T.delta.trait <- phylosig(m.phy,T.delta.trait,method="lambda",test=T)

T.low.trait <- mammal.temp$T.low
names(T.low.trait) <- mammal.temp.log$species
T.low.trait <- phylosig(m.phy,T.low.trait,method="lambda",test=T)

T.high.trait <- mammal.temp$T.high
names(T.high.trait) <- mammal.temp.log$species
T.high.trait <- phylosig(m.phy,T.high.trait,method="lambda",test=T)
```

```{r, "Table of Lambda Values and P-Values In Order to Find the Significant Phylogentic Signal in the Four Variables", fig.cap= "Table 2: Lambda Values and P-Values To Find the Significant Phylogentic Signal in the Four Variables", warning=FALSE, echo=FALSE}
phylo.sig.table <- matrix(c(0.999934, 1.83952e-11, 0.580389, 0.00776833, 0.791644, 0.00298335, 0.869769, 0.0409622), ncol=2, byrow = TRUE)
rownames(phylo.sig.table) <- c("Mass", "T.delta", "T.low", "T.high")
colnames(phylo.sig.table) <- c("Lamba", "p-value")
phylo.sig.table <- as.table(phylo.sig.table)
print(phylo.sig.table)
```

The above table shows the lambda values and p-values given the different temperature variables applied in order to find the significant phylogentic signal.
